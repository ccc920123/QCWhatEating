"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,u){try{var o=r[a](u),i=o.value}catch(e){return void t(e)}if(!o.done)return Promise.resolve(i).then(function(e){n("next",e)},function(e){n("throw",e)});e(i)}return n("next")})}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),_adbDriver=require("adb-driver"),_adbDriver2=_interopRequireDefault(_adbDriver),_debuglog=require("./debuglog"),_debuglog2=_interopRequireDefault(_debuglog),_utils=require("../lib/utils"),ADBCommander=function(){function e(){_classCallCheck(this,e),this.exec=_adbDriver2.default.exec}return _createClass(e,[{key:"_commandFactory",value:function(){function e(e){return r.apply(this,arguments)}var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.exec(r);case 2:if(!((t=e.sent)instanceof Error)){e.next=7;break}return e.abrupt("return",{err:t});case 7:return e.abrupt("return",{result:t});case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"deviceList",value:function(){function e(){return r.apply(this,arguments)}var r=_asyncToGenerator(regeneratorRuntime.mark(function e(){var r,t,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(e){return e.replace(/(\n|\r\n){1,}/g,"\n").split("\n").filter(function(e,r){var t=e.split("\t");return 0!==r&&"device"===t[1]}).map(function(e){return e.split("\t")[0]})},(0,_debuglog2.default)("deviceList(): start"),e.next=4,this._commandFactory("adb devices");case 4:return r=e.sent,t=r.result,n=r.err,e.abrupt("return",{deviceList:a(t),err:n});case 8:case"end":return e.stop()}},e,this)}));return e}()},{key:"reverse",value:function(){function e(e,t,n){return r.apply(this,arguments)}var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r,t,n){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a="adb -s "+r+" reverse tcp:"+n+" tcp:"+t,e.next=3,this._commandFactory(a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"forward",value:function(){function e(e,t,n){return r.apply(this,arguments)}var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r,t,n){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a="adb -s "+r+" forward tcp:"+t+" tcp:"+n,e.next=3,this._commandFactory(a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"version",value:function(){function e(){return r.apply(this,arguments)}var r=_asyncToGenerator(regeneratorRuntime.mark(function e(){var r,t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._commandFactory("adb version");case 2:return r=e.sent,t=r.result,n=r.err,e.abrupt("return",{version:t,err:n});case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"print",value:function(){function e(e){return r.apply(this,arguments)}var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var t,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._commandFactory(r);case 2:if(t=e.sent,n=t.result,!(a=t.err)){e.next=8;break}return _utils.colorconsole.error("### App Server ### print(): adb error: "+a.message),e.abrupt("return");case 8:(0,_debuglog2.default)("print(): "+n);case 9:case"end":return e.stop()}},e,this)}));return e}()}]),e}();exports.default=ADBCommander;