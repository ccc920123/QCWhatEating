"use strict";function frameworkInit(){global.framework={module:{base:"system",ext:"service"},reservedFeatures:[],reservedFeatureExclude:[],project:{manifestFilePath:null,featureList:[],module:{usedBaseAll:!1,usedExtAll:!1}}},global.framework.reservedFeatures=global.framework.reservedFeatures.concat([global.framework.module.base+".contact",global.framework.module.base+".webview",global.framework.module.base+".notification",global.framework.module.base+".media",global.framework.module.base+".file",global.framework.module.base+".storage",global.framework.module.base+".vibrator",global.framework.module.base+".calendar",global.framework.module.base+".shortcut",global.framework.module.base+".network",global.framework.module.base+".fetch",global.framework.module.base+".geolocation",global.framework.module.base+".request",global.framework.module.base+".share",global.framework.module.base+".clipboard",global.framework.module.base+".prompt",global.framework.module.base+".device",global.framework.module.base+".barcode",global.framework.module.base+".bluetooth",global.framework.module.base+".sensor",global.framework.module.base+".audio",global.framework.module.base+".package",global.framework.module.base+".volume",global.framework.module.base+".record",global.framework.module.base+".brightness",global.framework.module.base+".battery",global.framework.module.base+".image",global.framework.module.base+".cipher",global.framework.module.base+".sms",global.framework.module.ext+".alipay",global.framework.module.ext+".push",global.framework.module.ext+".pay",global.framework.module.ext+".share",global.framework.module.ext+".wxpay",global.framework.module.ext+".stats",global.framework.module.ext+".account",global.framework.module.ext+".wxaccount",global.framework.module.ext+".qqaccount",global.framework.module.ext+".wbaccount"]),global.framework.reservedFeatureExclude.push(global.framework.module.base+".app"),global.framework.reservedFeatureExclude.push(global.framework.module.base+".model"),global.framework.reservedFeatureExclude.push(global.framework.module.base+".router")}function updateSourceScript(e){var o=[],a=new RegExp("['\"]@("+global.framework.module.base+"|"+global.framework.module.ext+").*?['\"]","g"),r=new RegExp("['\"]@(("+global.framework.module.base+"|"+global.framework.module.ext+").*?)['\"]");return(e.match(a)||[]).forEach(function(e){var a=(e.match(r)||[])[1];a==="@"+global.framework.module.base?global.framework.project.module.usedBaseAll=!0:a==="@"+global.framework.module.ext?global.framework.project.module.usedExtAll=!0:-1!==global.framework.reservedFeatures.indexOf(a)?-1===global.framework.project.featureList.indexOf(a)&&global.framework.project.featureList.push(a):-1!==global.framework.reservedFeatureExclude.indexOf(a)||o.push({reason:"WARN: 您引入了未识别的native模块："+a})}),{fileCont:e,logFeatureList:o}}function updateManifestCont(e,o){var a=null;try{a=JSON.parse(e)}catch(e){throw _utils.colorconsole.error("ERROR: 解析manifest.json文件出错："+e.message),e}if(a){a.config=a.config||{},a.config.debug=!o.sign,a.minPlatformVersion||(a.minPlatformVersion=101),a.features=a.features||[];var r=[].concat(global.framework.project.featureList);a.features.forEach(function(e){var o=r.indexOf(e.name);-1!==o&&r.splice(o,1)});var l=[];if(r.forEach(function(e){-1!==global.framework.reservedFeatures.indexOf(e)&&l.push(e)}),l.length>0){var t=l.map(function(e){return{name:e}});a.features=a.features.concat(t),_utils.colorconsole.warn("manifest.json文件中添加未声明的features: "+l.join(", ")+"\n")}return e=JSON.stringify(a,null,2),{manifestCont:e}}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.updateManifestCont=exports.updateSourceScript=void 0;var _utils=require("./utils");frameworkInit(),exports.updateSourceScript=updateSourceScript,exports.updateManifestCont=updateManifestCont;