"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function getProjectName(){try{var e=process.cwd(),t=_path2.default.join(e,"src","manifest.json"),r=require(t);return r&&r.package||"Bundle"}catch(e){_utils.colorconsole.error("### App Server ### 获取项目名称出错："+e.message)}}function recordClient(e,t){var r=_path2.default.dirname(e),s={clients:[]};if(_fs2.default.existsSync(r)){if(_fs2.default.existsSync(e)&&(s=JSON.parse(_fs2.default.readFileSync(e).toString()),s.clients instanceof Array))for(s.clients=s.clients.filter(function(e){return e.ip!==t.ip||e.port!==t.port});s.clients.length>4;)s.clients.shift()}else(0,_utils.mkdirsSync)(r);s.clients.push(t),_fs2.default.writeFileSync(e,JSON.stringify(s))}function getServerAddress(e){return"http://"+(0,_utils.getIPv4IPAddress)()+(80===e?"":":"+e)}function getRecordClient(e,t,r){if(_fs2.default.existsSync(e)){var s=JSON.parse(_fs2.default.readFileSync(e).toString()),i=s.clients;return i=i instanceof Array?i:[],i.find(function(e){return e.sn===t&&e.ip===r&&e.port})}}function getClientFromRequest(e){var t=(0,_utils.getClientIPAddress)(e),r=(0,_utils.getIPv4IPAddress)(),s=e.header["device-serial-number"],i=LINK_MODE.NULL;return"127.0.0.1"===t&&s?i=LINK_MODE.ADB:"127.0.0.1"!==t&&t!==r&&(i=LINK_MODE.WIFI),{clientIp:t,sn:s,linkMode:i}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.LINK_MODE=exports.getRecordClient=exports.getClientFromRequest=exports.getServerAddress=exports.recordClient=exports.getProjectName=void 0;var _path=require("path"),_path2=_interopRequireDefault(_path),_fs=require("fs"),_fs2=_interopRequireDefault(_fs),_utils=require("../lib/utils"),LINK_MODE={NULL:0,WIFI:1,ADB:2};exports.getProjectName=getProjectName,exports.recordClient=recordClient,exports.getServerAddress=getServerAddress,exports.getClientFromRequest=getClientFromRequest,exports.getRecordClient=getRecordClient,exports.LINK_MODE=LINK_MODE;